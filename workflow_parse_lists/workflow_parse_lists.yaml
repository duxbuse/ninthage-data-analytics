# Uses 666654103849-compute@developer.gserviceaccount.com
main:
    params: [input]
    steps:
        - workflow_function_data_conversion:
            try:
                call: http.post
                args:
                    url: https://us-central1-ninthage-data-analytics.cloudfunctions.net/function_data_conversion
                    headers:
                        Content-type: application/json
                    body:
                        data: ${input}
                    auth:
                        type: OIDC
                result: json_file
            except:
                as: e
                steps:
                    - workflow_function_discord_error_reporting:
                        call: http.post
                        args:
                            url: https://us-central1-ninthage-data-analytics.cloudfunctions.net/function_discord_error_reporting
                            headers:
                                Content-type: application/json
                            body:
                                data: ${e}
                            auth:
                                type: OIDC

        - workflow_function_upload_data_into_bigquery:
            call: http.post
            args:
                url: https://us-central1-ninthage-data-analytics.cloudfunctions.net/function_upload_data_into_bigquery
                headers:
                    Content-type: application/json
                body:
                    json_file: ${json_file}
                auth:
                    type: OIDC
                result: upload_result

        - workflow_function_discord_success_reporting:
            call: http.post
            args:
                url: https://us-central1-ninthage-data-analytics.cloudfunctions.net/function_discord_success_reporting
                headers:
                    Content-type: application/json
                body:
                    data: ${upload_result}
                auth:
                    type: OIDC

        
        - returnOutput:
            return: ${upload_result}
